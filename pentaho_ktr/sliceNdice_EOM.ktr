<?xml version="1.0" encoding="UTF-8"?>
<transformation>
  <info>
    <name>sliceNdiceEOM</name>
    <description />
    <extended_description />
    <trans_version />
    <trans_type>Normal</trans_type>
    <trans_status>0</trans_status>
    <directory>/</directory>
    <parameters>
      <parameter>
        <name>CDATE</name>
        <default_value />
        <description />
      </parameter>
      <parameter>
        <name>PROCESS_DATE</name>
        <default_value />
        <description />
      </parameter>
    </parameters>
    <log>
      <trans-log-table>
        <connection />
        <schema />
        <table />
        <size_limit_lines />
        <interval />
        <timeout_days />
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STATUS</id>
          <enabled>Y</enabled>
          <name>STATUS</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
          <subject />
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
          <subject />
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
          <subject />
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
          <subject />
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
          <subject />
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
          <subject />
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>STARTDATE</id>
          <enabled>Y</enabled>
          <name>STARTDATE</name>
        </field>
        <field>
          <id>ENDDATE</id>
          <enabled>Y</enabled>
          <name>ENDDATE</name>
        </field>
        <field>
          <id>LOGDATE</id>
          <enabled>Y</enabled>
          <name>LOGDATE</name>
        </field>
        <field>
          <id>DEPDATE</id>
          <enabled>Y</enabled>
          <name>DEPDATE</name>
        </field>
        <field>
          <id>REPLAYDATE</id>
          <enabled>Y</enabled>
          <name>REPLAYDATE</name>
        </field>
        <field>
          <id>LOG_FIELD</id>
          <enabled>Y</enabled>
          <name>LOG_FIELD</name>
        </field>
        <field>
          <id>EXECUTING_SERVER</id>
          <enabled>N</enabled>
          <name>EXECUTING_SERVER</name>
        </field>
        <field>
          <id>EXECUTING_USER</id>
          <enabled>N</enabled>
          <name>EXECUTING_USER</name>
        </field>
        <field>
          <id>CLIENT</id>
          <enabled>N</enabled>
          <name>CLIENT</name>
        </field>
      </trans-log-table>
      <perf-log-table>
        <connection />
        <schema />
        <table />
        <interval />
        <timeout_days />
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>SEQ_NR</id>
          <enabled>Y</enabled>
          <name>SEQ_NR</name>
        </field>
        <field>
          <id>LOGDATE</id>
          <enabled>Y</enabled>
          <name>LOGDATE</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STEPNAME</id>
          <enabled>Y</enabled>
          <name>STEPNAME</name>
        </field>
        <field>
          <id>STEP_COPY</id>
          <enabled>Y</enabled>
          <name>STEP_COPY</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>INPUT_BUFFER_ROWS</id>
          <enabled>Y</enabled>
          <name>INPUT_BUFFER_ROWS</name>
        </field>
        <field>
          <id>OUTPUT_BUFFER_ROWS</id>
          <enabled>Y</enabled>
          <name>OUTPUT_BUFFER_ROWS</name>
        </field>
      </perf-log-table>
      <channel-log-table>
        <connection />
        <schema />
        <table />
        <timeout_days />
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>LOGGING_OBJECT_TYPE</id>
          <enabled>Y</enabled>
          <name>LOGGING_OBJECT_TYPE</name>
        </field>
        <field>
          <id>OBJECT_NAME</id>
          <enabled>Y</enabled>
          <name>OBJECT_NAME</name>
        </field>
        <field>
          <id>OBJECT_COPY</id>
          <enabled>Y</enabled>
          <name>OBJECT_COPY</name>
        </field>
        <field>
          <id>REPOSITORY_DIRECTORY</id>
          <enabled>Y</enabled>
          <name>REPOSITORY_DIRECTORY</name>
        </field>
        <field>
          <id>FILENAME</id>
          <enabled>Y</enabled>
          <name>FILENAME</name>
        </field>
        <field>
          <id>OBJECT_ID</id>
          <enabled>Y</enabled>
          <name>OBJECT_ID</name>
        </field>
        <field>
          <id>OBJECT_REVISION</id>
          <enabled>Y</enabled>
          <name>OBJECT_REVISION</name>
        </field>
        <field>
          <id>PARENT_CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>PARENT_CHANNEL_ID</name>
        </field>
        <field>
          <id>ROOT_CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>ROOT_CHANNEL_ID</name>
        </field>
      </channel-log-table>
      <step-log-table>
        <connection />
        <schema />
        <table />
        <timeout_days />
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STEPNAME</id>
          <enabled>Y</enabled>
          <name>STEPNAME</name>
        </field>
        <field>
          <id>STEP_COPY</id>
          <enabled>Y</enabled>
          <name>STEP_COPY</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>LOG_FIELD</id>
          <enabled>N</enabled>
          <name>LOG_FIELD</name>
        </field>
      </step-log-table>
      <metrics-log-table>
        <connection />
        <schema />
        <table />
        <timeout_days />
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>METRICS_DATE</id>
          <enabled>Y</enabled>
          <name>METRICS_DATE</name>
        </field>
        <field>
          <id>METRICS_CODE</id>
          <enabled>Y</enabled>
          <name>METRICS_CODE</name>
        </field>
        <field>
          <id>METRICS_DESCRIPTION</id>
          <enabled>Y</enabled>
          <name>METRICS_DESCRIPTION</name>
        </field>
        <field>
          <id>METRICS_SUBJECT</id>
          <enabled>Y</enabled>
          <name>METRICS_SUBJECT</name>
        </field>
        <field>
          <id>METRICS_TYPE</id>
          <enabled>Y</enabled>
          <name>METRICS_TYPE</name>
        </field>
        <field>
          <id>METRICS_VALUE</id>
          <enabled>Y</enabled>
          <name>METRICS_VALUE</name>
        </field>
      </metrics-log-table>
    </log>
    <maxdate>
      <connection />
      <table />
      <field />
      <offset>0.0</offset>
      <maxdiff>0.0</maxdiff>
    </maxdate>
    <size_rowset>10000</size_rowset>
    <sleep_time_empty>50</sleep_time_empty>
    <sleep_time_full>50</sleep_time_full>
    <unique_connections>N</unique_connections>
    <feedback_shown>Y</feedback_shown>
    <feedback_size>50000</feedback_size>
    <using_thread_priorities>Y</using_thread_priorities>
    <shared_objects_file />
    <capture_step_performance>N</capture_step_performance>
    <step_performance_capturing_delay>1000</step_performance_capturing_delay>
    <step_performance_capturing_size_limit>100</step_performance_capturing_size_limit>
    <dependencies>
    </dependencies>
    <partitionschemas>
    </partitionschemas>
    <slaveservers>
    </slaveservers>
    <clusterschemas>
    </clusterschemas>
    <created_user>-</created_user>
    <created_date>2015/05/26 11:01:32.920</created_date>
    <modified_user>-</modified_user>
    <modified_date>2015/05/26 11:01:32.920</modified_date>
    <key_for_session_key>H4sIAAAAAAAAAAMAAAAAAAAAAAA=</key_for_session_key>
    <is_key_private>N</is_key_private>
  </info>
  <notepads>
  </notepads>
  <connection>
    <name>epiphany_db</name>
    <server>epiphany-load.cayagee0hssn.us-west-2.rds.amazonaws.com</server>
    <type>MYSQL</type>
    <access>Native</access>
    <database>epiphany_db</database>
    <port>3306</port>
    <username>server_reports</username>
    <password>Encrypted 546865356d6f75736536ccf9c1ff1fd7c290a31cf773d29dacd1</password>
    <servername />
    <data_tablespace />
    <index_tablespace />
    <attributes>
      <attribute>
        <code>EXTRA_OPTION_MYSQL.defaultFetchSize</code>
        <attribute>500</attribute>
      </attribute>
      <attribute>
        <code>EXTRA_OPTION_MYSQL.useCursorFetch</code>
        <attribute>true</attribute>
      </attribute>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_LOWERCASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_UPPERCASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>IS_CLUSTERED</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>PORT_NUMBER</code>
        <attribute>3306</attribute>
      </attribute>
      <attribute>
        <code>PRESERVE_RESERVED_WORD_CASE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>QUOTE_ALL_FIELDS</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>STREAM_RESULTS</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_BOOLEAN_DATA_TYPE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_TIMESTAMP_DATA_TYPE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>USE_POOLING</code>
        <attribute>N</attribute>
      </attribute>
    </attributes>
  </connection>
  <order>
    <hop>
      <from>Pull Raw Data</from>
      <to>Add constants</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Add constants</from>
      <to>Order dataset</to>
      <enabled>N</enabled>
    </hop>
    <hop>
      <from>Order dataset</from>
      <to>Generate data collection SQL</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Generate data collection SQL</from>
      <to>Get Opportunities</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Get Opportunities</from>
      <to>Blocker</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Blocker</from>
      <to>Get Attempts</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Get Attempts</from>
      <to>Blocker 2</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Blocker 2</from>
      <to>Get Impressions</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Get Impressions</from>
      <to>Replace Empties</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Replace Empties</from>
      <to>Blocker 3</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Blocker 3</from>
      <to>Get Revenue</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Get Revenue</from>
      <to>Blocker 4</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Blocker 4</from>
      <to>Calculate CPM &amp; Fill</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Calculate CPM &amp; Fill</from>
      <to>Blocker 5</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Blocker 5</from>
      <to>Get Floors</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Get Floors</from>
      <to>Gateway Blocker</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Gateway Blocker</from>
      <to>Attach Marketplace Data</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Attach Marketplace Data</from>
      <to>Calculate Net Values</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Calculate Net Values</from>
      <to>Prepare for Insert at Marketplace Level</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Calculate Net Values</from>
      <to>Aggregate Data</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Prepare for Insert at Marketplace Level</from>
      <to>Calculated Numbers</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Aggregate Data</from>
      <to>Sort rows</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Sort rows</from>
      <to>Group by</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Group by</from>
      <to>Calculate NIS Level Metrics</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Calculate NIS Level Metrics</from>
      <to>Aggregated Numbers</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Select values</from>
      <to>Pull Raw Data</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Select values 2</from>
      <to>Order dataset</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Get Variables</from>
      <to>Select values</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Pull Raw Data</from>
      <to>Get Variables 2</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Get Variables 2</from>
      <to>Select values 2</to>
      <enabled>Y</enabled>
    </hop>
  </order>
  <step>
    <name>Add constants</name>
    <type>Constant</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <fields>
      <field>
        <name>cdate</name>
        <type>String</type>
        <format />
        <currency />
        <decimal />
        <group />
        <nullif>2017-06-01</nullif>
        <length>-1</length>
        <precision>-1</precision>
        <set_empty_string>N</set_empty_string>
      </field>
    </fields>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>384</xloc>
      <yloc>128</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Aggregate Data</name>
    <type>SelectValues</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <fields>
      <field>
        <name>cdate</name>
        <rename>date</rename>
      </field>
      <field>
        <name>invSourceID</name>
      </field>
      <field>
        <name>invSourceName</name>
      </field>
      <field>
        <name>countryID</name>
      </field>
      <field>
        <name>opportunities</name>
        <rename>adOpps</rename>
      </field>
      <field>
        <name>attempts</name>
        <rename>adAtts</rename>
      </field>
      <field>
        <name>impressions</name>
        <rename>adImps</rename>
      </field>
      <field>
        <name>revenue</name>
        <rename>adRevenue</rename>
      </field>
      <field>
        <name>market_ServingFee</name>
        <rename>servingCost</rename>
      </field>
      <field>
        <name>floorBase</name>
      </field>
      <field>
        <name>market_floorAdjustment</name>
        <rename>floorAdjustment</rename>
      </field>
      <field>
        <name>market_finalPublisherRev</name>
        <rename>finalRev_Publisher</rename>
      </field>
      <field>
        <name>market_ourFinalRev</name>
        <rename>finalRev_Epiphany</rename>
      </field>
      <select_unspecified>N</select_unspecified>
    </fields>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>96</xloc>
      <yloc>544</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Aggregated Numbers</name>
    <type>TableOutput</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <connection>epiphany_db</connection>
    <schema />
    <table>EOM_Aggregate</table>
    <commit>1000</commit>
    <truncate>N</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>Y</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field />
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field />
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field />
    <fields>
      <field>
        <column_name>date</column_name>
        <stream_name>date</stream_name>
      </field>
      <field>
        <column_name>invSourceID</column_name>
        <stream_name>invSourceID</stream_name>
      </field>
      <field>
        <column_name>countryID</column_name>
        <stream_name>countryID</stream_name>
      </field>
      <field>
        <column_name>adOpps</column_name>
        <stream_name>adOpps</stream_name>
      </field>
      <field>
        <column_name>adAtts</column_name>
        <stream_name>adAtts</stream_name>
      </field>
      <field>
        <column_name>adImps</column_name>
        <stream_name>adImps</stream_name>
      </field>
      <field>
        <column_name>adRevenue</column_name>
        <stream_name>adRevenue</stream_name>
      </field>
      <field>
        <column_name>servingCost</column_name>
        <stream_name>servingCost</stream_name>
      </field>
      <field>
        <column_name>floorBase</column_name>
        <stream_name>floorBase</stream_name>
      </field>
      <field>
        <column_name>floorAdjust</column_name>
        <stream_name>floorAdjustment</stream_name>
      </field>
      <field>
        <column_name>finalRev_ToPub</column_name>
        <stream_name>finalRev_Publisher</stream_name>
      </field>
      <field>
        <column_name>finalRev_ToEpiphany</column_name>
        <stream_name>finalRev_Epiphany</stream_name>
      </field>
      <field>
        <column_name>fillRate</column_name>
        <stream_name>NIS_fillRate</stream_name>
      </field>
      <field>
        <column_name>grossCPM</column_name>
        <stream_name>NIS_grossCPM</stream_name>
      </field>
      <field>
        <column_name>finalCPM_Pub</column_name>
        <stream_name>finalCPM_Pub</stream_name>
      </field>
      <field>
        <column_name>finalCPM_Epiphany</column_name>
        <stream_name>finalCPM_Epi</stream_name>
      </field>
    </fields>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>816</xloc>
      <yloc>544</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Attach Marketplace Data</name>
    <type>DynamicSQLRow</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <connection>epiphany_db</connection>
    <rowlimit>0</rowlimit>
    <sql>SELECT r.marketID, r.buyerID, r.countryID, SUM(r.adAtts) as market_impsTried, SUM(r.adImps) as market_impsFilled, SUM(r.adRevenue) as market_grossRev, m.marketplaceFee as marketplaceFee FROM EOM_Marketplace r, markets m</sql>
    <outer_join>Y</outer_join>
    <replace_vars>N</replace_vars>
    <sql_fieldname>sql_netRev</sql_fieldname>
    <query_only_on_change>N</query_only_on_change>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>96</xloc>
      <yloc>240</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Blocker</name>
    <type>BlockUntilStepsFinish</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <steps>
      <step>
        <name>Get Opportunities</name>
        <CopyNr>0</CopyNr>
      </step>
    </steps>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>992</xloc>
      <yloc>128</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Blocker 2</name>
    <type>BlockUntilStepsFinish</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <steps>
      <step>
        <name>Get Attempts</name>
        <CopyNr>0</CopyNr>
      </step>
    </steps>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1216</xloc>
      <yloc>128</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Blocker 3</name>
    <type>BlockUntilStepsFinish</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <steps>
      <step>
        <name>Replace Empties</name>
        <CopyNr>0</CopyNr>
      </step>
    </steps>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1168</xloc>
      <yloc>240</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Blocker 4</name>
    <type>BlockUntilStepsFinish</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <steps>
      <step>
        <name>Get Revenue</name>
        <CopyNr>0</CopyNr>
      </step>
    </steps>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>912</xloc>
      <yloc>240</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Blocker 5</name>
    <type>BlockUntilStepsFinish</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <steps>
      <step>
        <name>Calculate CPM &amp; Fill</name>
        <CopyNr>0</CopyNr>
      </step>
    </steps>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>592</xloc>
      <yloc>240</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Calculate CPM &amp; Fill</name>
    <type>ScriptValueMod</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <compatible>N</compatible>
    <optimizationLevel>9</optimizationLevel>
    <jsScripts>
      <jsScript>
        <jsScript_type>0</jsScript_type>
        <jsScript_name>Script 1</jsScript_name>
        <jsScript_script>//Script here

var grossCPM = revenue / (impressions / 1000);
var fillRate = impressions / opportunities;</jsScript_script>
      </jsScript>
    </jsScripts>
    <fields>
      <field>
        <name>grossCPM</name>
        <rename>grossCPM</rename>
        <type>Number</type>
        <length>16</length>
        <precision>2</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>fillRate</name>
        <rename>fillRate</rename>
        <type>Number</type>
        <length>16</length>
        <precision>2</precision>
        <replace>N</replace>
      </field>
    </fields>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>752</xloc>
      <yloc>240</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Calculate NIS Level Metrics</name>
    <type>ScriptValueMod</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <compatible>N</compatible>
    <optimizationLevel>9</optimizationLevel>
    <jsScripts>
      <jsScript>
        <jsScript_type>0</jsScript_type>
        <jsScript_name>Script 1</jsScript_name>
        <jsScript_script>//Script here

var NIS_fillRate = adImps / adOpps;
if ((isNaN(NIS_fillRate)) || !(isFinite(NIS_fillRate))) { NIS_fillRate = 0; }

var NIS_grossCPM = adRevenue / (adImps / 1000);
if ((isNaN(NIS_grossCPM)) || !(isFinite(NIS_grossCPM))) { NIS_grossCPM = 0; }

var NIS_finalCPMPub = finalRev_Publisher / (adImps / 1000);
if ((isNaN(NIS_finalCPMPub)) || !(isFinite(NIS_finalCPMPub))) { NIS_finalCPMPub = 0; }

var NIS_finalCPMEpi = finalRev_Epiphany / (adImps / 1000);
if ((isNaN(NIS_finalCPMEpi)) || !(isFinite(NIS_finalCPMEpi))) { NIS_finalCPMEpi = 0; }


</jsScript_script>
      </jsScript>
    </jsScripts>
    <fields>
      <field>
        <name>NIS_fillRate</name>
        <rename>NIS_fillRate</rename>
        <type>Number</type>
        <length>16</length>
        <precision>2</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>NIS_grossCPM</name>
        <rename>NIS_grossCPM</rename>
        <type>Number</type>
        <length>16</length>
        <precision>2</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>NIS_finalCPMPub</name>
        <rename>finalCPM_Pub</rename>
        <type>Number</type>
        <length>16</length>
        <precision>2</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>NIS_finalCPMEpi</name>
        <rename>finalCPM_Epi</rename>
        <type>Number</type>
        <length>16</length>
        <precision>2</precision>
        <replace>N</replace>
      </field>
    </fields>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>592</xloc>
      <yloc>544</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Calculate Net Values</name>
    <type>ScriptValueMod</type>
    <description />
    <distribute>N</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <compatible>N</compatible>
    <optimizationLevel>9</optimizationLevel>
    <jsScripts>
      <jsScript>
        <jsScript_type>0</jsScript_type>
        <jsScript_name>Script 1</jsScript_name>
        <jsScript_script>//Script here

var market_fillRate = (market_impsFilled / market_impsTried) * 100;
if ((isNaN(market_fillRate)) || !(isFinite(market_fillRate))) { market_fillRate = 0; }

var market_grossCPM = (market_grossRev / (market_impsFilled / 1000));
if ((isNaN(market_grossCPM)) || !(isFinite(market_grossCPM))) { market_grossCPM = 0; }

var marketCost = 0;
// var marketCostPlus; Use for additional fees
var fees_clearing = 0;
var fees_adassurance = 0;
var fees_platform = 0;

var market_ServingFee; 

if ((marketID &lt; 4) || (marketID == 28) || (marketID == 40)) { // AOL OVM + AOL PX + AOL NG + AOL Select + AOL Direct
	fees_clearing = market_grossRev * 0.03;
	// fees_adassurance = market_grossRev * 0.05;
	fees_adassurance = 0;
	fees_platform;
	marketCost = marketplaceFee;
	market_ServingFee = marketCost * market_grossRev;
} 

if (marketID &lt; 25 &amp;&amp; marketID > 4) { // Third-Party Demand
	marketCost = 0;
	market_ServingFee = (market_impsFilled / 1000) * 0.12;
} 

if ((marketID > 24 &amp;&amp; marketID &lt; 27) || (marketID == 30) || (marketID == 32) || (marketID == 34) || (marketID == 35) || (marketID == 36) || (marketID == 37)) { // DC OVM + DC PX + AS PX + AS OVM + AT OVM + AT PX + TM OVM + TM PX
	fees_clearing = market_grossRev * 0.03;
	fees_adassurance = 0;
	fees_platform;
	marketCost = marketplaceFee;
	market_ServingFee = marketCost * market_grossRev;
}

if ((marketID == 27) || (marketID == 38)) { // LKQD + Streamrail
	fees_clearing = 0;
	fees_adassurance  = 0;
	fees_platform;
	marketCost = marketplaceFee;
	market_ServingFee = marketCost * market_grossRev;
}

if (marketID == 39) { // Springserve
	fees_clearing = market_grossRev * 0.03;
	fees_adassurance  = 0;
	fees_platform;
	marketCost = marketplaceFee;
	market_ServingFee = marketCost * market_grossRev;
}
	

if ((marketID == 2) || (marketID == 3) || (marketID == 26) || (marketID == 30) || (marketID == 35) || (marketID == 37)) { // AOL PX + AOL NG + DC PX + AS PX + AT PX + TM PX
	fees_platform = market_grossRev * 0.1; } else { fees_platform = 0; 
}

if ((marketID == 27) || (marketID == 38)) { // LKQD + Streamrail
	fees_platform = (market_impsFilled / 1000) * 0.30; // LKQD Platform Fee
	// fees_platform = fees_platform + (market_grossRev * 0.18); // AOL/DC Demand Fee - To Be Replaced per Marketplace
}

if (marketID == 39) { // Springserve
	fees_platform = (market_impsFilled / 1000) * 0.20; // Springserve Platform Fee
}


var realFeeTotal = fees_clearing + fees_adassurance + fees_platform; 

var market_revSplitAmount = market_grossRev * (1 - revShareCut);
var market_revToClient = market_grossRev - market_ServingFee - market_revSplitAmount;
var market_minRev = 0;

if (floorBase > 0) { market_minRev = (market_impsFilled / 1000) * floorBase; }

var market_floorAdjustment = 0;

var market_finalNetRev = market_revToClient;

var market_finalPublisherRev = 0;

if (market_minRev > market_finalNetRev) {
	market_finalPublisherRev = market_minRev;
	market_floorAdjustment = market_minRev - market_finalNetRev; } 
else { 
	market_finalPublisherRev = market_finalNetRev; 
} 

var market_ourFinalRev = market_grossRev - realFeeTotal - market_finalPublisherRev;

var market_finalPubCPM = market_finalPublisherRev / (market_impsFilled / 1000);
if ((isNaN(market_finalPubCPM)) || !(isFinite(market_finalPubCPM))) { market_finalPubCPM = 0; }

var market_finalOurCPM = market_ourFinalRev / (market_impsFilled / 1000);
if ((isNaN(market_finalOurCPM)) || !(isFinite(market_finalOurCPM))) { market_finalOurCPM = 0; } 

var epiphanyMargin = market_ourFinalRev / market_grossRev;
if ((isNaN(epiphanyMargin)) || !(isFinite(epiphanyMargin))) { epiphanyMargin = 0; }

var epiphanyDeviation = abs(.30 - epiphanyMargin);

if ((isNaN(market_ServingFee)) || !(isFinite(market_ServingFee))) { market_ServingFee = 0; }
if ((isNaN(market_finalNetRev)) || !(isFinite(market_finalNetRev))) { market_finalNetRev = 0; }
if ((isNaN(market_finalPublisherRev)) || !(isFinite(market_finalPublisherRev))) { market_finalPublisherRev = 0; }
if ((isNaN(market_ourFinalRev)) || !(isFinite(market_ourFinalRev))) { market_ourFinalRev = 0; }

</jsScript_script>
      </jsScript>
    </jsScripts>
    <fields>
      <field>
        <name>market_fillRate</name>
        <rename>market_fillRate</rename>
        <type>Number</type>
        <length>16</length>
        <precision>3</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>market_grossCPM</name>
        <rename>market_grossCPM</rename>
        <type>Number</type>
        <length>16</length>
        <precision>3</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>marketCost</name>
        <rename>marketCost</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>market_ServingFee</name>
        <rename>market_ServingFee</rename>
        <type>Number</type>
        <length>16</length>
        <precision>2</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>revShareCut</name>
        <rename>revShareCut</rename>
        <type>Number</type>
        <length>16</length>
        <precision>2</precision>
        <replace>Y</replace>
      </field>
      <field>
        <name>market_revSplitAmount</name>
        <rename>market_revSplitAmount</rename>
        <type>Number</type>
        <length>16</length>
        <precision>2</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>market_revToClient</name>
        <rename>market_revToClient</rename>
        <type>Number</type>
        <length>16</length>
        <precision>2</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>market_minRev</name>
        <rename>market_minRev</rename>
        <type>Number</type>
        <length>16</length>
        <precision>2</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>market_floorAdjustment</name>
        <rename>market_floorAdjustment</rename>
        <type>Number</type>
        <length>16</length>
        <precision>2</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>market_finalNetRev</name>
        <rename>market_finalNetRev</rename>
        <type>Number</type>
        <length>16</length>
        <precision>2</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>market_finalPublisherRev</name>
        <rename>market_finalPublisherRev</rename>
        <type>Number</type>
        <length>16</length>
        <precision>2</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>market_ourFinalRev</name>
        <rename>market_ourFinalRev</rename>
        <type>Number</type>
        <length>16</length>
        <precision>2</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>market_finalPubCPM</name>
        <rename>market_finalPubCPM</rename>
        <type>Number</type>
        <length>16</length>
        <precision>2</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>market_finalOurCPM</name>
        <rename>market_finalOurCPM</rename>
        <type>Number</type>
        <length>16</length>
        <precision>2</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>epiphanyMargin</name>
        <rename>epiphanyMargin</rename>
        <type>Number</type>
        <length>16</length>
        <precision>2</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>epiphanyDeviation</name>
        <rename>epiphanyDeviation</rename>
        <type>Number</type>
        <length>16</length>
        <precision>2</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>fees_clearing</name>
        <rename>fees_clearing</rename>
        <type>Number</type>
        <length>16</length>
        <precision>2</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>fees_adassurance</name>
        <rename>fees_adassurance</rename>
        <type>Number</type>
        <length>16</length>
        <precision>2</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>fees_platform</name>
        <rename>fees_platform</rename>
        <type>Number</type>
        <length>16</length>
        <precision>2</precision>
        <replace>N</replace>
      </field>
    </fields>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>96</xloc>
      <yloc>416</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Calculated Numbers</name>
    <type>TableOutput</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <connection>epiphany_db</connection>
    <schema />
    <table>EOM_Final</table>
    <commit>1000</commit>
    <truncate>N</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>Y</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field />
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field />
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field />
    <fields>
      <field>
        <column_name>date</column_name>
        <stream_name>date</stream_name>
      </field>
      <field>
        <column_name>invSourceID</column_name>
        <stream_name>invSourceID</stream_name>
      </field>
      <field>
        <column_name>marketID</column_name>
        <stream_name>marketID</stream_name>
      </field>
      <field>
        <column_name>buyerID</column_name>
        <stream_name>buyerID</stream_name>
      </field>
      <field>
        <column_name>countryID</column_name>
        <stream_name>countryID</stream_name>
      </field>
      <field>
        <column_name>adAtts</column_name>
        <stream_name>adAtts</stream_name>
      </field>
      <field>
        <column_name>adImps</column_name>
        <stream_name>adImps</stream_name>
      </field>
      <field>
        <column_name>successRate</column_name>
        <stream_name>successRate</stream_name>
      </field>
      <field>
        <column_name>adRevenue</column_name>
        <stream_name>adRevenue</stream_name>
      </field>
      <field>
        <column_name>grossCPM</column_name>
        <stream_name>grossCPM</stream_name>
      </field>
      <field>
        <column_name>fee_clearingHouse</column_name>
        <stream_name>fee_clearingHouse</stream_name>
      </field>
      <field>
        <column_name>fee_adAssurance</column_name>
        <stream_name>fee_adassurance</stream_name>
      </field>
      <field>
        <column_name>fee_platform</column_name>
        <stream_name>fee_platform</stream_name>
      </field>
      <field>
        <column_name>servingCost</column_name>
        <stream_name>servingCost</stream_name>
      </field>
      <field>
        <column_name>floorBase</column_name>
        <stream_name>floorBase</stream_name>
      </field>
      <field>
        <column_name>floorAdjust</column_name>
        <stream_name>floorAdjust</stream_name>
      </field>
      <field>
        <column_name>finalCPM_Pub</column_name>
        <stream_name>finalCPM_Publisher</stream_name>
      </field>
      <field>
        <column_name>minRev_Net</column_name>
        <stream_name>minRev_Net</stream_name>
      </field>
      <field>
        <column_name>finalRev_Total</column_name>
        <stream_name>finalRev_Total</stream_name>
      </field>
      <field>
        <column_name>finalRev_ToPub</column_name>
        <stream_name>finalRev_ToPublisher</stream_name>
      </field>
      <field>
        <column_name>finalRev_ToEpiphany</column_name>
        <stream_name>finalRev_ToEpiphany</stream_name>
      </field>
      <field>
        <column_name>finalCPM_Epiphany</column_name>
        <stream_name>finalCPM_Epiphany</stream_name>
      </field>
      <field>
        <column_name>epiMargin</column_name>
        <stream_name>epiMargin</stream_name>
      </field>
      <field>
        <column_name>epiDeviation</column_name>
        <stream_name>epiDeviation</stream_name>
      </field>
    </fields>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>816</xloc>
      <yloc>416</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Gateway Blocker</name>
    <type>BlockUntilStepsFinish</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <steps>
      <step>
        <name>Get Floors</name>
        <CopyNr>0</CopyNr>
      </step>
    </steps>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>272</xloc>
      <yloc>240</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Generate data collection SQL</name>
    <type>ScriptValueMod</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <compatible>N</compatible>
    <optimizationLevel>9</optimizationLevel>
    <jsScripts>
      <jsScript>
        <jsScript_type>0</jsScript_type>
        <jsScript_name>Script 1</jsScript_name>
        <jsScript_script>//Script here

var sql_opportunities = "SELECT SUM(adOpps) FROM EOM_InventorySource WHERE invSourceID = " + invSourceID + " AND countryID = " + countryID + " AND date = '" + cdate + "'";
var sql_attempts = "SELECT SUM(adAtts) FROM EOM_Marketplace WHERE invSourceID = " + invSourceID + " AND countryID = " + countryID + " AND date = '" + cdate + "'";
var sql_impressions = "SELECT SUM(adImps) FROM EOM_Marketplace WHERE invSourceID = " + invSourceID + " AND countryID = " + countryID + " AND date = '" + cdate + "'";
var sql_grossRev = "SELECT SUM(adRevenue) FROM EOM_Marketplace WHERE invSourceID = " + invSourceID + " AND countryID = " + countryID + " AND date = '" + cdate + "'";
var sql_netRev = "SELECT r.marketID, r.buyerID, r.countryID, SUM(r.adAtts), SUM(r.adImps), SUM(r.adRevenue), m.marketplaceFee as marketplaceFee FROM EOM_Marketplace r, markets m WHERE r.marketID = m.id AND r.invSourceID = " + invSourceID + " AND r.countryID = " + countryID + " AND r.date = '" + cdate + "' GROUP BY marketID, buyerID, countryID";
var sql_floorBase = "SELECT floor FROM inventorySources WHERE id = " + invSourceID;</jsScript_script>
      </jsScript>
    </jsScripts>
    <fields>
      <field>
        <name>sql_opportunities</name>
        <rename>sql_opportunities</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>sql_attempts</name>
        <rename>sql_attempts</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>sql_impressions</name>
        <rename>sql_impressions</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>sql_grossRev</name>
        <rename>sql_grossRev</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>sql_netRev</name>
        <rename>sql_netRev</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>sql_floorBase</name>
        <rename>sql_floorBase</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
    </fields>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>688</xloc>
      <yloc>128</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Get Attempts</name>
    <type>DynamicSQLRow</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <connection>epiphany_db</connection>
    <rowlimit>1</rowlimit>
    <sql>SELECT SUM(adAtts) as attempts FROM EOM_Marketplace</sql>
    <outer_join>N</outer_join>
    <replace_vars>N</replace_vars>
    <sql_fieldname>sql_attempts</sql_fieldname>
    <query_only_on_change>N</query_only_on_change>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1120</xloc>
      <yloc>128</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Get Floors</name>
    <type>DynamicSQLRow</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <connection>epiphany_db</connection>
    <rowlimit>1</rowlimit>
    <sql>SELECT floor AS floorBase FROM inventorySources</sql>
    <outer_join>N</outer_join>
    <replace_vars>N</replace_vars>
    <sql_fieldname>sql_floorBase</sql_fieldname>
    <query_only_on_change>N</query_only_on_change>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>432</xloc>
      <yloc>240</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Get Impressions</name>
    <type>DynamicSQLRow</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <connection>epiphany_db</connection>
    <rowlimit>1</rowlimit>
    <sql>SELECT SUM(adImps) as impressions FROM EOM_Marketplace</sql>
    <outer_join>N</outer_join>
    <replace_vars>N</replace_vars>
    <sql_fieldname>sql_impressions</sql_fieldname>
    <query_only_on_change>N</query_only_on_change>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1328</xloc>
      <yloc>128</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Get Opportunities</name>
    <type>DynamicSQLRow</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <connection>epiphany_db</connection>
    <rowlimit>1</rowlimit>
    <sql>SELECT SUM(adOpps) as opportunities FROM EOM_InventorySource</sql>
    <outer_join>N</outer_join>
    <replace_vars>N</replace_vars>
    <sql_fieldname>sql_opportunities</sql_fieldname>
    <query_only_on_change>N</query_only_on_change>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>880</xloc>
      <yloc>128</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Get Revenue</name>
    <type>DynamicSQLRow</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <connection>epiphany_db</connection>
    <rowlimit>1</rowlimit>
    <sql>SELECT SUM(adRevenue) as revenue FROM EOM_Marketplace</sql>
    <outer_join>N</outer_join>
    <replace_vars>N</replace_vars>
    <sql_fieldname>sql_grossRev</sql_fieldname>
    <query_only_on_change>N</query_only_on_change>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1040</xloc>
      <yloc>240</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Get Variables</name>
    <type>GetVariable</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <fields>
      <field>
        <name>PROCESS_DATE</name>
        <variable>${PROCESS_DATE}</variable>
        <type>String</type>
        <format />
        <currency />
        <decimal />
        <group />
        <length>-1</length>
        <precision>-1</precision>
        <trim_type>none</trim_type>
      </field>
    </fields>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>32</xloc>
      <yloc>16</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Get Variables 2</name>
    <type>GetVariable</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <fields>
      <field>
        <name>CDATE</name>
        <variable>${CDATE}</variable>
        <type>String</type>
        <format />
        <currency />
        <decimal />
        <group />
        <length>-1</length>
        <precision>-1</precision>
        <trim_type>none</trim_type>
      </field>
    </fields>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>336</xloc>
      <yloc>32</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Group by</name>
    <type>GroupBy</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <all_rows>N</all_rows>
    <ignore_aggregate>N</ignore_aggregate>
    <field_ignore />
    <directory>%%java.io.tmpdir%%</directory>
    <prefix>grp</prefix>
    <add_linenr>N</add_linenr>
    <linenr_fieldname />
    <give_back_row>N</give_back_row>
    <group>
      <field>
        <name>date</name>
      </field>
      <field>
        <name>invSourceID</name>
      </field>
      <field>
        <name>countryID</name>
      </field>
    </group>
    <fields>
      <field>
        <aggregate>adOpps</aggregate>
        <subject>adOpps</subject>
        <type>AVERAGE</type>
        <valuefield />
      </field>
      <field>
        <aggregate>adAtts</aggregate>
        <subject>adAtts</subject>
        <type>AVERAGE</type>
        <valuefield />
      </field>
      <field>
        <aggregate>adImps</aggregate>
        <subject>adImps</subject>
        <type>AVERAGE</type>
        <valuefield />
      </field>
      <field>
        <aggregate>adRevenue</aggregate>
        <subject>adRevenue</subject>
        <type>AVERAGE</type>
        <valuefield />
      </field>
      <field>
        <aggregate>servingCost</aggregate>
        <subject>servingCost</subject>
        <type>SUM</type>
        <valuefield />
      </field>
      <field>
        <aggregate>floorBase</aggregate>
        <subject>floorBase</subject>
        <type>AVERAGE</type>
        <valuefield />
      </field>
      <field>
        <aggregate>floorAdjustment</aggregate>
        <subject>floorAdjustment</subject>
        <type>SUM</type>
        <valuefield />
      </field>
      <field>
        <aggregate>finalRev_Publisher</aggregate>
        <subject>finalRev_Publisher</subject>
        <type>SUM</type>
        <valuefield />
      </field>
      <field>
        <aggregate>finalRev_Epiphany</aggregate>
        <subject>finalRev_Epiphany</subject>
        <type>SUM</type>
        <valuefield />
      </field>
    </fields>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>384</xloc>
      <yloc>544</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Order dataset</name>
    <type>SortRows</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <directory>%%java.io.tmpdir%%</directory>
    <prefix>out</prefix>
    <sort_size>1000000</sort_size>
    <free_memory />
    <compress>N</compress>
    <compress_variable />
    <unique_rows>N</unique_rows>
    <fields>
      <field>
        <name>invSourceID</name>
        <ascending>Y</ascending>
        <case_sensitive>N</case_sensitive>
        <collator_enabled>N</collator_enabled>
        <collator_strength>2</collator_strength>
        <presorted>N</presorted>
      </field>
      <field>
        <name>countryID</name>
        <ascending>Y</ascending>
        <case_sensitive>N</case_sensitive>
        <collator_enabled>N</collator_enabled>
        <collator_strength>2</collator_strength>
        <presorted>N</presorted>
      </field>
    </fields>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>512</xloc>
      <yloc>128</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Prepare for Insert at Marketplace Level</name>
    <type>SelectValues</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <fields>
      <field>
        <name>cdate</name>
        <rename>date</rename>
      </field>
      <field>
        <name>invSourceID</name>
      </field>
      <field>
        <name>invSourceName</name>
      </field>
      <field>
        <name>marketID</name>
      </field>
      <field>
        <name>buyerID</name>
      </field>
      <field>
        <name>countryID</name>
      </field>
      <field>
        <name>revShareCut</name>
      </field>
      <field>
        <name>market_impsTried</name>
        <rename>adAtts</rename>
      </field>
      <field>
        <name>market_impsFilled</name>
        <rename>adImps</rename>
      </field>
      <field>
        <name>market_fillRate</name>
        <rename>successRate</rename>
      </field>
      <field>
        <name>market_grossRev</name>
        <rename>adRevenue</rename>
      </field>
      <field>
        <name>market_grossCPM</name>
        <rename>grossCPM</rename>
      </field>
      <field>
        <name>market_ServingFee</name>
        <rename>servingCost</rename>
      </field>
      <field>
        <name>fees_clearing</name>
        <rename>fee_clearingHouse</rename>
      </field>
      <field>
        <name>fees_adassurance</name>
        <rename>fee_adassurance</rename>
      </field>
      <field>
        <name>fees_platform</name>
        <rename>fee_platform</rename>
      </field>
      <field>
        <name>floorBase</name>
      </field>
      <field>
        <name>market_floorAdjustment</name>
        <rename>floorAdjust</rename>
      </field>
      <field>
        <name>marketplaceFee</name>
      </field>
      <field>
        <name>market_minRev</name>
        <rename>minRev_Net</rename>
      </field>
      <field>
        <name>market_finalNetRev</name>
        <rename>finalRev_Total</rename>
      </field>
      <field>
        <name>market_finalPublisherRev</name>
        <rename>finalRev_ToPublisher</rename>
      </field>
      <field>
        <name>market_ourFinalRev</name>
        <rename>finalRev_ToEpiphany</rename>
      </field>
      <field>
        <name>market_finalPubCPM</name>
        <rename>finalCPM_Publisher</rename>
      </field>
      <field>
        <name>market_finalOurCPM</name>
        <rename>finalCPM_Epiphany</rename>
      </field>
      <field>
        <name>epiphanyMargin</name>
        <rename>epiMargin</rename>
      </field>
      <field>
        <name>epiphanyDeviation</name>
        <rename>epiDeviation</rename>
      </field>
      <select_unspecified>N</select_unspecified>
    </fields>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>464</xloc>
      <yloc>416</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Pull Raw Data</name>
    <type>TableInput</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <connection>epiphany_db</connection>
    <sql>SELECT i.id as invSourceID, i.name as invSourceName, i.revShareCut, i.floor, r.countryID 
FROM inventorySources i, EOM_Marketplace r 
WHERE
i.id = r.invSourceID AND r.date = ?
GROUP BY r.invSourceID, r.countryID</sql>
    <limit>0</limit>
    <lookup>Select values</lookup>
    <execute_each_row>Y</execute_each_row>
    <variables_active>Y</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>256</xloc>
      <yloc>128</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Replace Empties</name>
    <type>ValueMapper</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <field_to_use>opportunities</field_to_use>
    <target_field />
    <non_match_default />
    <fields>
      <field>
        <source_value />
        <target_value>0</target_value>
      </field>
    </fields>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1328</xloc>
      <yloc>240</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Select values</name>
    <type>SelectValues</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <fields>
      <select_unspecified>N</select_unspecified>
      <meta>
        <name>PROCESS_DATE</name>
        <rename>cdate</rename>
        <type>String</type>
        <length>-2</length>
        <precision>-2</precision>
        <conversion_mask>yyyy-MM-dd</conversion_mask>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale />
        <date_format_timezone />
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding />
        <decimal_symbol />
        <grouping_symbol />
        <currency_symbol />
        <storage_type />
      </meta>
    </fields>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>144</xloc>
      <yloc>128</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Select values 2</name>
    <type>SelectValues</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <fields>
      <select_unspecified>N</select_unspecified>
      <meta>
        <name>CDATE</name>
        <rename>cdate</rename>
        <type>String</type>
        <length>-2</length>
        <precision>-2</precision>
        <conversion_mask>yyyy-MM-dd</conversion_mask>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale />
        <date_format_timezone />
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding />
        <decimal_symbol />
        <grouping_symbol />
        <currency_symbol />
        <storage_type />
      </meta>
    </fields>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>448</xloc>
      <yloc>32</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Sort rows</name>
    <type>SortRows</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <directory>%%java.io.tmpdir%%</directory>
    <prefix>out</prefix>
    <sort_size>1000000</sort_size>
    <free_memory />
    <compress>N</compress>
    <compress_variable />
    <unique_rows>N</unique_rows>
    <fields>
      <field>
        <name>date</name>
        <ascending>Y</ascending>
        <case_sensitive>N</case_sensitive>
        <collator_enabled>N</collator_enabled>
        <collator_strength>2</collator_strength>
        <presorted>N</presorted>
      </field>
      <field>
        <name>invSourceID</name>
        <ascending>Y</ascending>
        <case_sensitive>N</case_sensitive>
        <collator_enabled>N</collator_enabled>
        <collator_strength>2</collator_strength>
        <presorted>N</presorted>
      </field>
      <field>
        <name>countryID</name>
        <ascending>Y</ascending>
        <case_sensitive>N</case_sensitive>
        <collator_enabled>N</collator_enabled>
        <collator_strength>2</collator_strength>
        <presorted>N</presorted>
      </field>
    </fields>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>224</xloc>
      <yloc>544</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step_error_handling>
  </step_error_handling>
  <slave-step-copy-partition-distribution>
  </slave-step-copy-partition-distribution>
  <slave_transformation>N</slave_transformation>
</transformation>
